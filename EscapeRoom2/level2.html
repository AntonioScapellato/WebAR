<!---->
<!--<>-->
<html>
<head>
  <title>CAOS VR | Escape Room</title>
   <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
   <script src="https://rawgit.com/rdub80/aframe-gui/master/dist/aframe-gui.min.js"></script>
   <meta name="apple-mobile-web-app-capable" content="yes">
   <meta charset="utf-8" />
</head>
<body>
    <a-scene>
        <a-assets>
        <!--IMMAGINI-->
            <a-img id="teleport" src="img/passi1/steps.png"></a-img>
            <!--PUZZLE-->
            <a-img id="puzzle11" src="img/stellata_puzzle/stellata11/row-1-col-1.png"></a-img>
            <a-img id="puzzle12" src="img/stellata_puzzle/stellata12/row-1-col-2.png"></a-img>
            <a-img id="puzzle13" src="img/stellata_puzzle/stellata13/row-1-col-3.png"></a-img>
            <a-img id="puzzle14" src="img/stellata_puzzle/stellata14/row-1-col-4.png"></a-img>
            <a-img id="puzzle15" src="img/stellata_puzzle/stellata15/row-1-col-5.png"></a-img>
            <a-img id="puzzle21" src="img/stellata_puzzle/stellata21/row-2-col-1.png"></a-img>
            <a-img id="puzzle22" src="img/stellata_puzzle/stellata22/row-2-col-2.png"></a-img>
            <a-img id="puzzle23" src="img/stellata_puzzle/stellata23/row-2-col-3.png"></a-img>
            <a-img id="puzzle24" src="img/stellata_puzzle/stellata24/row-2-col-4.png"></a-img>
            <a-img id="puzzle25" src="img/stellata_puzzle/stellata25/row-2-col-5.png"></a-img>
            <a-img id="puzzle31" src="img/stellata_puzzle/stellata31/row-3-col-1.png"></a-img>
            <a-img id="puzzle32" src="img/stellata_puzzle/stellata32/row-3-col-2.png"></a-img>
            <a-img id="puzzle33" src="img/stellata_puzzle/stellata33/row-3-col-3.png"></a-img>
            <a-img id="puzzle34" src="img/stellata_puzzle/stellata34/row-3-col-4.png"></a-img>
            <a-img id="puzzle35" src="img/stellata_puzzle/stellata35/row-3-col-5.png"></a-img>
            <a-img id="puzzle41" src="img/stellata_puzzle/stellata41/row-4-col-1.png"></a-img>
            <a-img id="puzzle42" src="img/stellata_puzzle/stellata42/row-4-col-2.png"></a-img>
            <a-img id="puzzle43" src="img/stellata_puzzle/stellata43/row-4-col-3.png"></a-img>
            <a-img id="puzzle44" src="img/stellata_puzzle/stellata44/row-4-col-4.png"></a-img>
            <a-img id="puzzle45" src="img/stellata_puzzle/stellata45/row-4-col-5.png"></a-img>
            <a-img id="puzzle51" src="img/stellata_puzzle/stellata51/row-5-col-1.png"></a-img>
            <a-img id="puzzle52" src="img/stellata_puzzle/stellata52/row-5-col-2.png"></a-img>
            <a-img id="puzzle53" src="img/stellata_puzzle/stellata53/row-5-col-3.png"></a-img>
            <a-img id="puzzle54" src="img/stellata_puzzle/stellata54/row-5-col-4.png"></a-img>
            <a-img id="puzzle55" src="img/stellata_puzzle/stellata55/row-5-col-5.png"></a-img>





            <a-img id="arrow" src="img/freccia1/freccia1.jpg"></a-img>













        <!--OGGETTI-->
            <!--SOGGIORNO-->
            <a-asset-item id="room" src="obj/soggiorno2/scene.gltf"></a-asset-item></a-assets>
            <!--TELECOMANDO-->
            <a-asset-item id="remote_control" src="obj/telecomando1/Remote_control.gltf"></a-asset-item>
            <!--MANO-->
            <a-asset-item id="handObj" src="obj/mano2/mano.obj"></a-asset-item>
            <a-asset-item id="handMtl" src="obj/mano2/mano.mtl"></a-asset-item>
        
        
        </a-assets>

    <!--GIOCATORE-->
        <!--CAMERA 3 + CURSORE-->
        <a-entity id="cameraRig" position="0 0 0">
            <a-camera look-controls wasd-controls position="0 -2 0">
                <a-gui-cursor id="cursor" design="ring" cursor="fuse: true; fuseTimeout: 1000; maxDistance=: 100"
                    position="0 0 -1" geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
                    material="color: black; shader: flat" raycaster="objects: .clickable">
                </a-gui-cursor> <!-- /cursor -->

                <!--MANO-->
                <a-obj-model id="mano" src="#handObj" mtl="#handMtl" scale="0.172 0.030 0.110" position="0.825 -0.815 -1.211" rotation="180 -90 0">
                </a-obj-model>

            </a-camera> <!-- /camera -->
        </a-entity>

    <!--STANZA: ELEMENTI NON CLICCABILI-->

        <!--SOGGIORNO-->
        <a-entity id="casa" gltf-model="#room" scale="0.00001 0.00001 0.00001" position="-0.540 -3.000 4.920"   rotation="0 0 0"></a-entity></a-entity>

        <!--PARETE DESTRA-->
        <a-plane id="pareteDestra" color="black" scale="9.590 4.080 1" position="-1.770 -0.385 -5.119" rotation="0 0 0"></a-plane>


        
        

    <!--TELETRASPORTO-->
        <a-image id="passo1" src="#teleport" scale="1 1 1" position="0.133 -2.088 0.100" rotation="90 -90 0"class="clickable"></a-image>

        <a-image id="passo2" src="#teleport" scale="1 1 1" position="-2.231 -2.088 2.266" rotation="-90 0 0" class="clickable">
        </a-image>

        <a-image id="passo3" src="#teleport" scale="1 1 1" position="-4.231 -2.088 0.100" rotation="90 90 0" class="clickable">
        </a-image>

        <a-image id="passo4" src="#teleport" scale="1 1 1" position="-2.231 -2.088 -3.905" rotation="90 0 0" class="clickable"> </a-image>

    <!-- 1-PRIMO ENIGMA: -->
        <!-- TELECOMANDO: -->
        <a-entity id="telecomando" gltf-model="#remote_control" scale="0.0004 0.0003 0.0007" position="-2.324 -1.443 3.531" rotation="0 180 0">
        </a-entity>
        


    <!-- 2-SECONDO ENIGMA: OROLOGIO -->
        <!-- FRECCE -->
        <a-image id="freccia0" src="#arrow" onclick="gira(0)" position="2.019 0.982 4.275" rotation="0 0 -90" scale="1.020 0.880 1" class="clickable"></a-image>

        <a-image id="freccia1" src="#arrow" onclick="gira(1)" position="2.019 -0.235 4.275" rotation="0 0 -90" scale="1.020 0.880 1" class="clickable">
        </a-image>
    
        <a-image id="freccia2" src="#arrow" onclick="gira(2)" position="1.988 -1.448 4.275" rotation="0 0 -90" scale="1.020 0.880 1" class="clickable">
        </a-image>

    <!-- 3-TERZO ENIGMA: -->
        <!-- PORTA-->
        <a-plane id="planeOpen" visible="false" position="0 0 0" class="clickable"></a-plane>


    </a-scene>

    <script>

    /*DICHIARAZIONI*/

        //PERSONAGGIO
        var io=document.querySelector
        ('#cameraRig');

        //STANZA: NON CLICCABILI
        sceneEl=document.querySelector('a-scene');

        //TELETRASPORTO
        var passi= new Array();
        for (var a = 1; a <= 4; a++)
        {
            passi[a]=document.querySelector('#passo' + a);
        }


        //1-PRIMO ENIGMA: TELECOMANDO
        for(var i=0; i<2; i++)
       {
           for(var j=0; j<2; j++)
           {}
       }

        //2-SECONDO ENIGMA: FRECCE
        var frecce = new Array();
        for(var g=0;g<3;g++)
        {
            frecce[g]=document.querySelector('#freccia' + g);
        }
        var posizioneFreccia= new Array();
        for(var h=0; h<3;h++)
        {
             posizioneFreccia[h] = -90;
             console.log(posizioneFreccia[h]);
        }
        
        var numTurn = 0;
        

        //3-TERZO ENIGMA: PUZZLE
        var puzzle = [];
        for (var d = 1; d <= 5; d++) 
            {
                puzzle[d] = new Array(6);
            }
        var selezionoPuzzle=0;
        var tempPImage;
        var scambiaPuzzle;
        var vintoPuzzle = 1;
        var planeOpen = document.querySelector('#planeOpen');
        var tempPuzzle;


    /*TELETRASPORTO*/

    passi[1].addEventListener('click', function (evt) {
        io.setAttribute('position', { x: 0.133, y: 0, z: 0.100 });
    });
    passi[2].addEventListener('click', function (evt) {
        io.setAttribute('position', { x: -2.231, y: 0, z: 2.266 });
    });
    passi[3].addEventListener('click', function (evt) {
        io.setAttribute('position', { x: -4.231, y: 0, z: 0.100 });
    });
    passi[4].addEventListener('click', function (evt) {
        io.setAttribute('position', { x: -2.231, y: 0, z: -3.905 });
    });


    /*1-PRIMO ENIGMA*/
        //TELECOMANDO




    /*2-SECONDO ENIGMA*/
            //FRECCE
             function gira(numTurn){
                //QUANDO CLICCA FRECCIA RUOTA DI 90 GRADI
                frecce[numTurn].setAttribute('rotation', { x: 0, y: 0, z: posizioneFreccia[numTurn] });
                if(posizioneFreccia[numTurn]==180)
                {
                    posizioneFreccia[numTurn]=-90;
                }
                else
                {
                    posizioneFreccia[numTurn] = posizioneFreccia[numTurn] + 90;
                }
                frecce[numTurn].setAttribute('rotation', {x: 0, y: 0, z: posizioneFreccia[numTurn]});
                
                if((numTurn==2 || numTurn==0 ) && posizioneFreccia[2]==180 && posizioneFreccia[0]==90)
                {
                    console.log('ho vintoorologio');
                }

        

               
                       
                    }
                   
                    
            



    /*3-TERZO ENIGMA*/
        //PUZZLE
        for(var b=1; b <= 5; b++)
        {
            for (var c = 1; c <= 5; c++)
            {  
                
                tempPuzzle= document.createElement('a-plane');
                sceneEl.appendChild(tempPuzzle);
                
                tempPuzzle.setAttribute('src', '#puzzle' + b + c);
                tempPuzzle.setAttribute('id', 'puzzle' + b + c);
                tempPuzzle.setAttribute('position', {x: (b/4) - 3, y: (c/4)-0.5, z: -5});
                tempPuzzle.setAttribute('scale', {x:0.25, y:0.25, z:0.25});
                tempPuzzle.setAttribute('class', 'clickable');
                puzzle[b][c] = tempPuzzle;
                tempPuzzle.addEventListener('click', function(event){

                    if (selezionoPuzzle == 0)
                    {
                
                    tempPImage = this.getAttribute('src');
                    this.setAttribute('visible', 'false');
                    scambiaPuzzle= this;
                    selezionoPuzzle++;
                    }

                    else
                    {
                        scambiaPuzzle.setAttribute('src', ''+this.getAttribute('src'));
                       this.setAttribute('src', tempPImage);
                        scambiaPuzzle.setAttribute('visible', 'true');
                        selezionoPuzzle = 0;
                        
                        
                    }
                });

                
                
            }

            
        }
        
    planeOpen.addEventListener('click', function (evt) {
       

        for (var e = 1; e <= 5 && vintoPuzzle == 1; e++) {
            for (var f = 1; f <= 5 && vintoPuzzle == 1; f++) {
                var confrontaPuzzle = '#puzzle' + e + f;
                console.log(confrontaPuzzle);
                var tempProva = puzzle[e][f].getAttribute('src');
                console.log(puzzle[e][f].getAttribute('src'));
                /*var srcPuzzle= puzzle[e][f];
                console.log(srcPuzzle);*/
                if (tempProva!= confrontaPuzzle) 
                {
                    vintoPuzzle = 0;
                    console.log('eco');
                }
            }
        }

        if (vintoPuzzle == 1) {
            console.log('VINTO');
        }

    });

    

    

    </script>



</body>
  </html>
